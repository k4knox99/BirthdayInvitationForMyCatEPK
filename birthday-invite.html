<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Will you be my Birthday Date?</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            font-family: 'Arial', sans-serif;
            display: flex; flex-direction: column;
            align-items: center; justify-content: center;
            min-height: 100vh; background-color: #ffffff;
            text-align: center;
        }

        #main-container {
            display: flex; flex-direction: column;
            align-items: center; z-index: 1; padding: 20px 20px 80px;
        }

        #main-gif {
            width: 280px; height: 220px; object-fit: cover;
            border-radius: 12px; margin-bottom: 20px;
        }

        h1 { font-size: 2rem; margin: 10px 0; color: #111; }
        #subtext { font-size: 1.1rem; color: #555; margin-bottom: 30px; }

        #button-container {
            display: flex; align-items: center; justify-content: center;
            gap: 15px; flex-wrap: wrap; min-height: 70px;
        }

        button { cursor: pointer; border: none; border-radius: 8px; font-weight: bold; }

        #yes-btn {
            background-color: #2ece6b; color: white;
            font-size: 1.5rem; padding: 15px 30px;
            border-radius: 50px; z-index: 2; flex-shrink: 0;
            transition: background-color .2s;
        }
        #yes-btn:hover { background-color: #25b85c; }

        #no-btn {
            background-color: #ef4444; color: white;
            font-size: 1.2rem; padding: 15px 30px;
            border-radius: 50px; white-space: nowrap;
            flex-shrink: 0; z-index: 2;
        }

        #share-btn {
            background-color: #58a6ff; color: white;
            font-size: 1.2rem; padding: 10px 20px;
            border-radius: 20px; display: none; margin-top: 20px;
            transition: background-color .2s;
        }
        #share-btn:hover { background-color: #3b8de0; }

        footer {
            position: fixed; bottom: 0; width: 100%;
            background-color: #f3f4f6; color: #4b5563;
            padding: 15px 0; font-size: 0.85rem; text-align: center;
        }
        footer a { color: #4b5563; text-decoration: underline; }

        /* sync indicator */
        #syncDot {
            position: fixed; top: 12px; right: 14px;
            width: 10px; height: 10px; border-radius: 50%;
            background: #ccc; z-index: 60;
            transition: background .4s;
            title: "Sync status";
        }
        #syncDot.live { background: #4caf50; }
        #syncDot.saving { background: #ff9800; }

        /* ‚îÄ‚îÄ SECRET GEAR ‚îÄ‚îÄ */
        #secretBtn {
            position: fixed; bottom: 55px; right: 16px;
            background: rgba(231,84,128,.13); color: #e75480;
            border: none; border-radius: 50%; width: 36px; height: 36px;
            font-size: 18px; cursor: pointer; z-index: 50; transition: background .2s;
        }
        #secretBtn:hover { background: rgba(231,84,128,.28); }

        /* ‚îÄ‚îÄ PASSWORD MODAL ‚îÄ‚îÄ */
        #pwModal {
            display: none; position: fixed; inset: 0;
            background: rgba(0,0,0,.5); z-index: 200;
            align-items: center; justify-content: center;
        }
        #pwModal.open { display: flex; }
        #pwBox {
            background: #fff; border-radius: 16px; padding: 28px 24px;
            width: 300px; text-align: center;
            box-shadow: 0 12px 40px rgba(0,0,0,.2);
        }
        #pwBox h3 { color: #e75480; margin-bottom: 14px; font-size: 16px; }
        .pw-input {
            width: 100%; padding: 9px 11px; border: 1.5px solid #ffb3c6;
            border-radius: 8px; font-size: 15px; outline: none;
            margin-bottom: 10px; text-align: center; letter-spacing: 4px; font-family: Arial;
        }
        .pw-input:focus { border-color: #e75480; }
        .pw-btn {
            width: 100%; padding: 10px;
            background: linear-gradient(135deg,#ff6eb4,#e75480);
            color: #fff; border: none; border-radius: 8px; font-size: 14px;
            font-weight: 800; cursor: pointer; margin-bottom: 8px;
        }
        #pwError { color: #f44336; font-size: 12px; display: none; margin-top: 4px; }
        #pwCancel { background: none; border: none; color: #aaa; font-size: 13px; cursor: pointer; }

        /* ‚îÄ‚îÄ EDITOR OVERLAY ‚îÄ‚îÄ */
        #editorOverlay {
            display: none; position: fixed; inset: 0;
            background: rgba(0,0,0,.55); z-index: 100;
            align-items: center; justify-content: center; padding: 16px;
        }
        #editorOverlay.open { display: flex; }
        #editorBox {
            background: #fff; border-radius: 20px; padding: 24px;
            width: 100%; max-width: 540px; max-height: 90vh; overflow-y: auto;
            font-size: 14px; box-shadow: 0 20px 60px rgba(0,0,0,.25);
        }
        #editorBox h2 {
            color: #e75480; margin-bottom: 6px; font-size: 17px;
            display: flex; align-items: center; justify-content: space-between;
        }
        .sync-note {
            font-size: 11px; color: #4caf50; font-weight: 600; margin-bottom: 14px;
        }
        .close-btn {
            background: #ffeef4; color: #e75480; border: none; border-radius: 8px;
            padding: 4px 12px; font-size: 13px; cursor: pointer; font-weight: 700;
        }
        #editorBox label { display: block; color: #555; margin: 12px 0 4px; font-weight: 700; font-size: 13px; }
        .small-lbl { font-weight: 400 !important; color: #bbb !important; font-size: 11px !important; }
        .ed-input {
            width: 100%; padding: 9px 11px; border: 1.5px solid #ffb3c6;
            border-radius: 8px; font-size: 13px; outline: none; font-family: Arial;
        }
        .ed-input:focus { border-color: #e75480; }

        .gif-section { background: #fff5f8; border: 1.5px solid #ffccd8; border-radius: 12px; padding: 14px; margin-bottom: 6px; }
        .gif-section h3 { color: #e75480; font-size: 13px; margin-bottom: 10px; }
        .gif-presets { display: flex; gap: 8px; flex-wrap: wrap; margin-bottom: 10px; }
        .gif-preset { cursor: pointer; border: 2px solid #ffb3c6; border-radius: 10px; overflow: hidden; transition: border-color .2s, transform .15s; background: #fff; flex-shrink: 0; }
        .gif-preset:hover { border-color: #e75480; transform: scale(1.05); }
        .gif-preset.active { border-color: #e75480; box-shadow: 0 0 0 3px #ffd0de; }
        .gif-preset img { width: 76px; height: 60px; object-fit: cover; display: block; }
        .gif-preset span { display: block; text-align: center; font-size: 10px; color: #888; padding: 2px 4px 4px; }
        .gif-custom { display: flex; gap: 8px; align-items: center; }
        .gif-custom .ed-input { flex: 1; }
        .btn-use { background: #e75480; color: #fff; border: none; border-radius: 8px; padding: 9px 12px; font-size: 12px; font-weight: 700; cursor: pointer; white-space: nowrap; }
        .btn-use:hover { background: #c4365e; }
        .ed-hr { border: none; border-top: 1.5px dashed #ffe0ec; margin: 14px 0 8px; }
        .no-messages-list { margin-top: 8px; }
        .no-msg-row { display: flex; align-items: center; gap: 6px; margin-bottom: 6px; }
        .no-msg-row .ed-input { flex: 1; }
        .btn-remove { background: #ff6b6b; color: #fff; border: none; border-radius: 6px; width: 28px; height: 28px; cursor: pointer; font-size: 16px; flex-shrink: 0; }
        .btn-add { margin-top: 6px; background: #e75480; color: #fff; border: none; border-radius: 8px; padding: 6px 14px; cursor: pointer; font-size: 13px; font-weight: 700; }
        .btn-add:hover { background: #c4365e; }
        #btnApply {
            display: block; width: 100%; margin-top: 18px; padding: 12px;
            background: linear-gradient(135deg, #ff6eb4, #e75480);
            color: #fff; border: none; border-radius: 10px; font-size: 15px; font-weight: 800; cursor: pointer;
        }
        #btnApply:hover { opacity: .9; }
    </style>
</head>
<body>

    <div id="syncDot" title="Sync: connecting‚Ä¶"></div>

    <div id="main-container">
        <img id="main-gif" src="https://media.giphy.com/media/gHo1P7oxz7WtapcFNI/giphy.gif" alt="Cute GIF">
        <h1 id="question">Will you be my Birthday Date? üéÇ</h1>
        <p id="subtext">March 1st wouldn't be the same without you!</p>
        <div id="button-container">
            <button id="yes-btn">Count me in!</button>
            <button id="no-btn">No</button>
        </div>
        <button id="share-btn">Share Now ‚û°</button>
    </div>

    <footer>
        ¬© 2025 @yourfish_kmh. All rights reserved.
        <a href="#">Privacy Policy</a>. Made with ‚ù§Ô∏è by Fish_kmh
    </footer>

    <!-- SECRET GEAR -->
    <button id="secretBtn" onclick="openPw()" title="Settings">‚öôÔ∏è</button>

    <!-- PASSWORD MODAL -->
    <div id="pwModal">
        <div id="pwBox">
            <h3>üîê Creator Access</h3>
            <input class="pw-input" type="password" id="pwInput" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢" maxlength="20"
                onkeydown="if(event.key==='Enter')checkPw()">
            <button class="pw-btn" onclick="checkPw()">Unlock Editor</button>
            <p id="pwError">Wrong password, try again!</p>
            <button id="pwCancel" onclick="closePw()">Cancel</button>
        </div>
    </div>

    <!-- EDITOR OVERLAY -->
    <div id="editorOverlay">
        <div id="editorBox">
            <h2>‚úèÔ∏è Customize Invite <button class="close-btn" onclick="closeEditor()">‚úï Close</button></h2>
            <p class="sync-note">üü¢ Changes save instantly ‚Äî her page updates automatically!</p>

            <div class="gif-section">
                <h3>üêß Main GIF</h3>
                <div class="gif-presets" id="mainPresets">
                    <div class="gif-preset active" onclick="pickMain(this,'https://media.giphy.com/media/gHo1P7oxz7WtapcFNI/giphy.gif')">
                        <img src="https://media.giphy.com/media/gHo1P7oxz7WtapcFNI/giphy.gif" alt=""><span>Sad Please</span>
                    </div>
                    <div class="gif-preset" onclick="pickMain(this,'https://media.giphy.com/media/afEXgnASzEbtcIZM1C/giphy.gif')">
                        <img src="https://media.giphy.com/media/afEXgnASzEbtcIZM1C/giphy.gif" alt=""><span>Sad Cry</span>
                    </div>
                    <div class="gif-preset" onclick="pickMain(this,'https://media.giphy.com/media/IqiumInk6n9vaONHp9/giphy.gif')">
                        <img src="https://media.giphy.com/media/IqiumInk6n9vaONHp9/giphy.gif" alt=""><span>Pout</span>
                    </div>
                    <div class="gif-preset" onclick="pickMain(this,'https://media.giphy.com/media/qOrqUuBXjxrwcCvH7S/giphy.gif')">
                        <img src="https://media.giphy.com/media/qOrqUuBXjxrwcCvH7S/giphy.gif" alt=""><span>Shy ü•∫</span>
                    </div>
                    <div class="gif-preset" onclick="pickMain(this,'https://media.giphy.com/media/E0Z9JNoQ7CBaScFw75/giphy.gif')">
                        <img src="https://media.giphy.com/media/E0Z9JNoQ7CBaScFw75/giphy.gif" alt=""><span>Love ‚ù§Ô∏è</span>
                    </div>
                </div>
                <div class="gif-custom">
                    <input class="ed-input" type="url" id="gifUrl" placeholder="Or paste any direct .gif URL‚Ä¶">
                    <button class="btn-use" onclick="useCustomMain()">Use ‚ûú</button>
                </div>
            </div>

            <div class="ed-hr"></div>
            <label>Main Title</label>
            <input class="ed-input" type="text" id="titleText" value="Will you be my Birthday Date? üéÇ">
            <label>Subtitle</label>
            <input class="ed-input" type="text" id="subtitleText" value="March 1st wouldn't be the same without you!">
            <label>"Yes" Button Label</label>
            <input class="ed-input" type="text" id="yesLabel" value="Count me in!">
            <label>Success Message</label>
            <input class="ed-input" type="text" id="successMsg" value="YAY! Best birthday present ever!! See you then! ‚ú®">

            <div class="ed-hr"></div>
            <label>"No" Button Messages <span class="small-lbl">(cycles one by one, button runs away!)</span></label>
            <div class="no-messages-list" id="noList"></div>
            <button class="btn-add" onclick="addNoMsg()">+ Add Message</button>

            <div class="ed-hr"></div>
            <div class="gif-section">
                <h3>üéâ Success GIF (after she says Yes)</h3>
                <div class="gif-presets" id="successPresets">
                    <div class="gif-preset active" onclick="pickSuccess(this,'https://media.giphy.com/media/nmYuapfnOxptMyieTF/giphy.gif')">
                        <img src="https://media.giphy.com/media/nmYuapfnOxptMyieTF/giphy.gif" alt=""><span>Flying Kiss</span>
                    </div>
                    <div class="gif-preset" onclick="pickSuccess(this,'https://media.giphy.com/media/PvZ3r8GXtTSjPc0zAd/giphy.gif')">
                        <img src="https://media.giphy.com/media/PvZ3r8GXtTSjPc0zAd/giphy.gif" alt=""><span>Love Kiss</span>
                    </div>
                    <div class="gif-preset" onclick="pickSuccess(this,'https://media.giphy.com/media/vPyNy6uNHJZaLcfbQW/giphy.gif')">
                        <img src="https://media.giphy.com/media/vPyNy6uNHJZaLcfbQW/giphy.gif" alt=""><span>I Love You</span>
                    </div>
                    <div class="gif-preset" onclick="pickSuccess(this,'https://media.giphy.com/media/QeQbG77MfXlfWTUC49/giphy.gif')">
                        <img src="https://media.giphy.com/media/QeQbG77MfXlfWTUC49/giphy.gif" alt=""><span>Hug Kiss</span>
                    </div>
                    <div class="gif-preset" onclick="pickSuccess(this,'https://media.giphy.com/media/tJ1sSKaNSsLQPAEval/giphy.gif')">
                        <img src="https://media.giphy.com/media/tJ1sSKaNSsLQPAEval/giphy.gif" alt=""><span>Love U üíï</span>
                    </div>
                </div>
                <div class="gif-custom">
                    <input class="ed-input" type="url" id="successGifUrl" placeholder="Or paste any direct .gif URL‚Ä¶">
                    <button class="btn-use" onclick="useCustomSuccess()">Use ‚ûú</button>
                </div>
            </div>

            <button id="btnApply" onclick="applyAll()">üíæ Save & Sync to Her Page</button>
        </div>
    </div>

    <script>
        const SECRET_PASSWORD = 'fish2025';
        const STORAGE_KEY     = 'birthday-invite-settings';

        // ‚îÄ‚îÄ DEFAULT SETTINGS ‚îÄ‚îÄ
        const DEFAULTS = {
            mainGif:     'https://media.giphy.com/media/gHo1P7oxz7WtapcFNI/giphy.gif',
            successGif:  'https://media.giphy.com/media/nmYuapfnOxptMyieTF/giphy.gif',
            title:       'Will you be my Birthday Date? üéÇ',
            subtitle:    'March 1st wouldn\'t be the same without you!',
            yesLabel:    'Count me in!',
            successMsg:  'YAY! Best birthday present ever!! See you then! ‚ú®',
            noMessages: [
                "Are you sure? It's My Big Day ü•∫",
                "I'm deleting my birthday from the calendar.",
                "Please? ü•∫",
                "Don't do this to me!",
                "My Birthday Wish Was Just To See U Ly üíï",
                "Is it Because I'm Pisces (Fish Ly)?",
                "Ek lo Pop",
                "Pls, Cat Kalay",
                ":((", 
                "Still No?",
                "Pls Pls Pls Cat Cat üê±",
                "Pls Count Me In pr tot üôè"
            ]
        };

        let currentMain    = DEFAULTS.mainGif;
        let currentSuccess = DEFAULTS.successGif;
        let noMessages     = [...DEFAULTS.noMessages];

        let noClickCount = 0;
        let noIsFixed    = false;
        let lastSavedData = null;

        const mainGif      = document.getElementById("main-gif");
        const question     = document.getElementById("question");
        const subText      = document.getElementById("subtext");
        const yesBtn       = document.getElementById("yes-btn");
        const noBtn        = document.getElementById("no-btn");
        const btnContainer = document.getElementById("button-container");
        const shareBtn     = document.getElementById("share-btn");
        const syncDot      = document.getElementById("syncDot");

        // ‚îÄ‚îÄ APPLY SETTINGS TO THE CARD UI ‚îÄ‚îÄ
        function applySettingsToCard(s) {
            question.innerText   = s.title;
            subText.innerText    = s.subtitle;
            yesBtn.innerText     = s.yesLabel;
            mainGif.src          = s.mainGif;
            currentMain          = s.mainGif;
            currentSuccess       = s.successGif;
            noMessages           = [...s.noMessages];

            // Sync editor fields if editor is open
            const titleEl = document.getElementById('titleText');
            if (titleEl) {
                titleEl.value = s.title;
                document.getElementById('subtitleText').value = s.subtitle;
                document.getElementById('yesLabel').value     = s.yesLabel;
                document.getElementById('successMsg').value   = s.successMsg;
            }
        }

        // ‚îÄ‚îÄ LOAD FROM STORAGE & APPLY ‚îÄ‚îÄ
        async function loadSettings() {
            try {
                const result = await window.storage.get(STORAGE_KEY, true); // shared=true
                if (result && result.value) {
                    const s = JSON.parse(result.value);
                    applySettingsToCard(s);
                    lastSavedData = result.value;
                    syncDot.classList.add('live');
                    syncDot.title = 'Sync: live ‚úÖ';
                }
            } catch(e) {
                // No saved settings yet ‚Äî use defaults
                syncDot.classList.add('live');
                syncDot.title = 'Sync: live ‚úÖ';
            }
        }

        // ‚îÄ‚îÄ POLL FOR CHANGES (every 4 seconds) ‚îÄ‚îÄ
        async function pollForChanges() {
            try {
                const result = await window.storage.get(STORAGE_KEY, true);
                if (result && result.value && result.value !== lastSavedData) {
                    lastSavedData = result.value;
                    const s = JSON.parse(result.value);
                    applySettingsToCard(s);
                    // Flash dot green to show update received
                    syncDot.style.background = '#00e676';
                    setTimeout(() => { syncDot.classList.add('live'); }, 600);
                }
                syncDot.classList.add('live');
            } catch(e) {
                syncDot.classList.remove('live');
                syncDot.title = 'Sync: error';
            }
        }

        // ‚îÄ‚îÄ SAVE TO STORAGE ‚îÄ‚îÄ
        async function saveSettings(s) {
            syncDot.classList.remove('live');
            syncDot.classList.add('saving');
            syncDot.title = 'Saving‚Ä¶';
            try {
                const data = JSON.stringify(s);
                await window.storage.set(STORAGE_KEY, data, true); // shared=true so both tabs see it
                lastSavedData = data;
                syncDot.classList.remove('saving');
                syncDot.classList.add('live');
                syncDot.title = 'Sync: live ‚úÖ';
            } catch(e) {
                syncDot.classList.remove('saving');
                syncDot.title = 'Sync: save failed ‚ùå';
                alert('Save failed ‚Äî please try again.');
            }
        }

        // ‚îÄ‚îÄ PASSWORD ‚îÄ‚îÄ
        function openPw() {
            document.getElementById('pwModal').classList.add('open');
            document.getElementById('pwInput').value = '';
            document.getElementById('pwError').style.display = 'none';
            setTimeout(() => document.getElementById('pwInput').focus(), 100);
        }
        function closePw() { document.getElementById('pwModal').classList.remove('open'); }
        function checkPw() {
            if (document.getElementById('pwInput').value === SECRET_PASSWORD) {
                closePw(); openEditor();
            } else {
                document.getElementById('pwError').style.display = 'block';
                document.getElementById('pwInput').value = '';
            }
        }

        // ‚îÄ‚îÄ EDITOR ‚îÄ‚îÄ
        function openEditor() {
            // Populate editor fields with current values
            document.getElementById('titleText').value    = question.innerText;
            document.getElementById('subtitleText').value = subText.innerText;
            document.getElementById('yesLabel').value     = yesBtn.innerText;
            document.getElementById('successMsg').value   = DEFAULTS.successMsg;
            renderNoList();
            document.getElementById('editorOverlay').classList.add('open');
        }
        function closeEditor() { document.getElementById('editorOverlay').classList.remove('open'); }

        // ‚îÄ‚îÄ GIF PICKERS ‚îÄ‚îÄ
        function pickMain(el, url) {
            document.querySelectorAll('#mainPresets .gif-preset').forEach(p => p.classList.remove('active'));
            el.classList.add('active'); currentMain = url;
            document.getElementById('gifUrl').value = '';
        }
        function pickSuccess(el, url) {
            document.querySelectorAll('#successPresets .gif-preset').forEach(p => p.classList.remove('active'));
            el.classList.add('active'); currentSuccess = url;
            document.getElementById('successGifUrl').value = '';
        }
        function useCustomMain() {
            const u = document.getElementById('gifUrl').value.trim();
            if (!u) { alert('Paste a URL first!'); return; }
            document.querySelectorAll('#mainPresets .gif-preset').forEach(p => p.classList.remove('active'));
            currentMain = u;
        }
        function useCustomSuccess() {
            const u = document.getElementById('successGifUrl').value.trim();
            if (!u) { alert('Paste a URL first!'); return; }
            document.querySelectorAll('#successPresets .gif-preset').forEach(p => p.classList.remove('active'));
            currentSuccess = u;
        }

        // ‚îÄ‚îÄ NO MESSAGES LIST ‚îÄ‚îÄ
        function esc(s) { return s.replace(/"/g,'&quot;').replace(/</g,'&lt;'); }
        function renderNoList() {
            const list = document.getElementById('noList');
            list.innerHTML = '';
            noMessages.forEach((msg, i) => {
                const row = document.createElement('div');
                row.className = 'no-msg-row';
                row.innerHTML = `
                    <input class="ed-input" type="text" value="${esc(msg)}"
                        oninput="noMessages[${i}]=this.value" placeholder="Message ${i+1}">
                    <button class="btn-remove" onclick="removeNoMsg(${i})">√ó</button>`;
                list.appendChild(row);
            });
        }
        function addNoMsg() { noMessages.push(''); renderNoList(); }
        function removeNoMsg(i) { noMessages.splice(i,1); renderNoList(); }

        // ‚îÄ‚îÄ APPLY & SAVE ‚îÄ‚îÄ
        async function applyAll() {
            const inputs = document.querySelectorAll('#noList .ed-input');
            noMessages = Array.from(inputs).map(i => i.value).filter(v => v.trim());

            const settings = {
                mainGif:    currentMain,
                successGif: currentSuccess,
                title:      document.getElementById('titleText').value,
                subtitle:   document.getElementById('subtitleText').value,
                yesLabel:   document.getElementById('yesLabel').value,
                successMsg: document.getElementById('successMsg').value,
                noMessages: [...noMessages]
            };

            // Apply immediately to this page
            applySettingsToCard(settings);

            // Reset No button
            noClickCount = 0; noIsFixed = false;
            noBtn.innerText = 'No';
            noBtn.style.cssText = '';

            // Save to shared storage ‚Üí her page will auto-update within 4 seconds
            const btn = document.getElementById('btnApply');
            btn.innerText = '‚è≥ Saving‚Ä¶'; btn.disabled = true;
            await saveSettings(settings);
            btn.innerText = '‚úÖ Saved & Synced!'; btn.style.background = '#4caf50';
            setTimeout(() => {
                btn.innerText = 'üíæ Save & Sync to Her Page';
                btn.style.background = '';
                btn.disabled = false;
            }, 2000);

            closeEditor();
        }

        // ‚îÄ‚îÄ NO BUTTON RUN AWAY ‚îÄ‚îÄ
        noBtn.addEventListener("click", function () {
            if (noClickCount < noMessages.length) {
                noBtn.innerText = noMessages[noClickCount];
            } else {
                noBtn.innerText = noMessages[noMessages.length - 1];
            }
            noClickCount++;

            if (!noIsFixed) {
                const rect = noBtn.getBoundingClientRect();
                noBtn.style.position = 'fixed';
                noBtn.style.left     = rect.left + 'px';
                noBtn.style.top      = rect.top  + 'px';
                noBtn.style.margin   = '0';
                noBtn.style.zIndex   = '999';
                noIsFixed = true;
            }

            const newSize = Math.max(10, 19 - noClickCount);
            const newPadV = Math.max(6,  15 - noClickCount);
            const newPadH = Math.max(12, 30 - noClickCount * 2);
            noBtn.style.fontSize = newSize + 'px';
            noBtn.style.padding  = `${newPadV}px ${newPadH}px`;

            const vw = window.innerWidth, vh = window.innerHeight;
            const bw = noBtn.offsetWidth || 80, bh = noBtn.offsetHeight || 40;
            const newLeft = Math.max(0, Math.random() * (vw - bw));
            const newTop  = Math.max(0, Math.random() * (vh - bh - 60));
            noBtn.style.transition = 'left .4s cubic-bezier(.34,1.56,.64,1), top .4s cubic-bezier(.34,1.56,.64,1), font-size .2s, padding .2s';
            noBtn.style.left = newLeft + 'px';
            noBtn.style.top  = newTop  + 'px';
        });

        // ‚îÄ‚îÄ YES BUTTON ‚îÄ‚îÄ
        yesBtn.addEventListener("click", async function () {
            let sucMsg = DEFAULTS.successMsg;
            try {
                const result = await window.storage.get(STORAGE_KEY, true);
                if (result && result.value) {
                    const s = JSON.parse(result.value);
                    sucMsg      = s.successMsg || sucMsg;
                    mainGif.src = s.successGif || currentSuccess;
                } else {
                    mainGif.src = currentSuccess;
                }
            } catch(e) { mainGif.src = currentSuccess; }

            question.innerText         = sucMsg;
            subText.style.display      = "none";
            btnContainer.style.display = "none";
            noBtn.style.display        = "none";
            shareBtn.style.display     = "inline-block";
        });

        // ‚îÄ‚îÄ SHARE ‚îÄ‚îÄ
        shareBtn.addEventListener("click", function () {
            if (navigator.share) {
                navigator.share({ title: "Birthday Date Invite", url: location.href });
            } else {
                navigator.clipboard.writeText(location.href).then(() => alert("‚úÖ Link copied!"));
            }
        });

        // Close modals on backdrop
        document.getElementById('pwModal').addEventListener('click', e => {
            if (e.target === document.getElementById('pwModal')) closePw();
        });
        document.getElementById('editorOverlay').addEventListener('click', e => {
            if (e.target === document.getElementById('editorOverlay')) closeEditor();
        });

        // ‚îÄ‚îÄ INIT: load saved settings then start polling ‚îÄ‚îÄ
        loadSettings().then(() => {
            setInterval(pollForChanges, 4000); // check every 4 seconds
        });
    </script>
</body>
</html>
